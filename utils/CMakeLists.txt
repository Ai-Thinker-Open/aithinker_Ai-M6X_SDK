sdk_generate_library()

if(CONFIG_LOG_DISABLE)
sdk_add_compile_definitions(-DCONFIG_LOG_DISABLE)
endif()

if(CONFIG_ASSERT_DISABLE)
sdk_add_compile_definitions(-DCONFIG_ASSERT_DISABLE)
endif()

if(DEFINED CONFIG_LOG_LEVEL)
sdk_add_compile_definitions(-DCONFIG_LOG_LEVEL=${CONFIG_LOG_LEVEL})
else()
sdk_add_compile_definitions(-DCONFIG_LOG_LEVEL=3)
endif()

# vsnprintf config
if(CONFIG_VSNPRINTF_FLOAT)
sdk_add_compile_definitions(-DVLIBC_FLOAT=${CONFIG_VSNPRINTF_FLOAT})
sdk_add_compile_definitions(-DPRINTF_SUPPORT_DECIMAL_SPECIFIERS=${CONFIG_VSNPRINTF_FLOAT})
endif()
if(CONFIG_VSNPRINTF_FLOAT_EX)
sdk_add_compile_definitions(-DVLIBC_FLOAT_EX=${CONFIG_VSNPRINTF_FLOAT_EX})
sdk_add_compile_definitions(-DPRINTF_SUPPORT_EXPONENTIAL_SPECIFIERS=${CONFIG_VSNPRINTF_FLOAT_EX})
endif()
if(CONFIG_VSNPRINTF_LONG_LONG)
sdk_add_compile_definitions(-DVLIBC_LONG_LONG=${CONFIG_VSNPRINTF_LONG_LONG})
sdk_add_compile_definitions(-DPRINTF_SUPPORT_LONG_LONG=${CONFIG_VSNPRINTF_LONG_LONG})
endif()
if(CONFIG_VSNPRINTF_WRITEBACK)
sdk_add_compile_definitions(-DVLIBC_WRITEBACK=${CONFIG_VSNPRINTF_WRITEBACK})
endif()

if(CONFIG_VLIBC)
if(CONFIG_VLIBC_FATFS)
sdk_add_compile_definitions(-DVLIBC_PORT_FATFS)
endif()
sdk_add_compile_definitions(-DVLIBC_DEBUG)
sdk_add_compile_definitions(-Dprintf=vlibc_printf)
sdk_library_add_sources(vlibc/printf.c)
sdk_library_add_sources(vlibc/syscalls.c)
sdk_library_add_sources(vlibc/vlibc_stdio.c)
sdk_library_add_sources(vlibc/vlibc_vsnprintf.c)
sdk_add_include_directories(vlibc)
else()
sdk_add_compile_definitions(-Dprintf=bflb_printf)
sdk_library_add_sources(libc/vsnprintf.c)
sdk_library_add_sources(libc/syscalls.c)
sdk_library_add_sources(libc/printf.c)
endif()

sdk_library_add_sources(mmheap/mmheap.c)
sdk_add_include_directories(mmheap)

sdk_library_add_sources(log/log.c)
sdk_add_include_directories(log)

sdk_add_link_options(-u_malloc_r -u_vsnprintf)